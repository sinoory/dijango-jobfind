<html>
    <head>
        <script type="text/javascript" src="../../../static/js/jquery-1.10.1.js"></script>
        <script type="text/javascript" src="../../../static/js/jscolor/jscolor.js"></script>
        </script>
        <script language="javascript">
        var startId=0;
        var totalRcd=0;
        var current=0;
        var endId=0
        function dbg(msg){
            $("#console").text(msg);
        }
        function keyDown(e) { 
            var keycode = e.which; 
            var realkey = String.fromCharCode(e.which); 
            var t="keycode: " + keycode + " charcode: " + realkey;
            dbg(t);
            if(keycode==37){ //prev
                current-=1;
                if(current<startId){current=startId}
                $("#idcur").text(current);
                showRcd(current);
            }else if(keycode==39){//next
                current+=1;
                if(current>endId){current=endId}
                $("#idcur").text(current);
                showRcd(current);
            }else {
                newstatus=""
                if(keycode==78){//N:null
                    newstatus="null"
                }else if(keycode==71){//G:get
                    newstatus="get"
                }else if(keycode==87){//W:
                    newstatus="watch"
                }
                if(newstatus.length>0)
                    modifyStatus(current,newstatus)
            }

            //alert("keycode: " + keycode + " charcode: " + realkey); 
        } 
        function showRcd(id){
             var aj = $.ajax( { 
                url:id,
                type:'get',
                cache:'false',
                success:function(data){
                    if(data.msg =="true" ){    
                    // view("修改成功！");    
                    dbg("修改成功！");    
                    }else{    
                    //$("#content").text(unescape(data));
                    //Lesson:json: use eval convert string to json object,and  also change unicaode(\ue342 ...) to utf8
                    job=eval ("(" + data + ")"); 
                    $("#coname").html("<a href='"+job.courl+"' target='_blank' >"+job.coname+"<a/>");
                    $("#codesc").text(job.cd.replace(/\n/g,"    "));
                    $("#job").html("<a href='"+job.jobu+"' target='_blank' >"+job.job+"<a/>");
                    $("#jobdesc").html(job.jd.replace(/\n/g,"<br/>"));//use html() to show tags
                    $("#jstate").text(job.state)
                    totalRcd=job.jobsCnt
                    endId=startId+totalRcd;
                    $("#idend").text(":"+endId)
                    //testrn(job.jd)
                    } 
                },
                error:function(){
                    dbg("error");
                },

            }); 
       }
        document.onkeydown = keyDown;
         function modifyStatus(id,newstatus){
            postdata={
                status:newstatus,
            }
             var aj = $.ajax( { 
                url:"modify/"+current+"/",
                type:'post',
                cache:'false',
                data:postdata,
                success:function(data){
                    dbg("ok,data="+data) 
                    $("#jstate").text(newstatus)
                },
                error:function(){
                    dbg("error");
                },

            }); 
       }
      function testrn(str){
            alert(str)
       }
        $(document).ready(function(){
            startId={{start_id}}; //template variables
            totalRcd={{total_rcd}};
            current=startId;
            endId=startId+totalRcd;
            $("#idcur").text(current);
            $("#idstart").text(startId+":")
            $("#idend").text(":"+endId)
            $("#idtextareacur").hide()
        });
        function test(){
            //dbg(unescape("{\u82e5\u9690\u82e5\u73b0}"))
            //dbg(unescape("\u5408\u80a5\u4e2d\u7ee7\u4fe1\u606f\u79d1\u6280\u6709\u9650\u516c\u53f8"))
            //dbg(unescape("Android\u8f6f\u4ef6\u5f00\u53d1\u5de5\u7a0b\u5e08"))
        }
        function submitres(){
            var check=confirm("submit data status to local db?")
            if(check){
              var aj = $.ajax( { 
                url:"submitstatus",
                type:'post',
                cache:'false',
                success:function(data){
                },
                error:function(){
                    dbg("error");
                },

            }); 
               
            }
        }

        function showInput(){
            var t=$("#idcur").text()
            $("#idcur").hide()
            $("#idtextareacur").val(t)
            $("#idtextareacur").show()
        }
        function showCur(){
            var t=$("#idtextareacur").val()
            $("#idcur").show()
            $("#idtextareacur").hide()
            $("#idcur").text(t)
            current=Number(t)
            showRcd(current);
        }
        </script>
        
    </head>
    
    <body  class='bodybkgrd'>
        <table>
            <tr>
                <td><span id='idstart'></span><input id='idtextareacur' value='99' type='text' onchange='showCur()' ><span id='idcur' onclick='showInput()'></span><span id='idend'></span></td>
                <td><input type='button' value='submit' onclick='submitres()'></input></td>
                <td><a href="/jobfind/querry">querry jobs</a></td>
            </tr>
        </table>
        <!-- http://jscolor.com/try.php#onchange  -->
        <input id='idcolorpicker' class='color'  onchange="$('body').css('background-color','#'+this.color)">
        <!--
        <button onclick='test()'>test2</button>
        -->
        <p id='coname'></p>
        <p id='codesc'></p>
        <table><tr><td id='jstate'><td id='job'></td></td></tr></table>
        <!--
        <p id='job'></p>
        <p id='jstate'></p>
        -->
        <p id='jobdesc'></p>
        <p id="console"></p>
        <p id='content' ></p>
    </body>
</html>
